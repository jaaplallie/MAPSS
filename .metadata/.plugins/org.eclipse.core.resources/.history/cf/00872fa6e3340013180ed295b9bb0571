package Gui;

import javax.swing.*;

import java.awt.*;
import java.awt.List;
import java.awt.image.*;
import java.io.*;
import java.util.*;
import javax.imageio.*;
import org.jfree.chart.*;
import org.jfree.data.category.*;
import org.jfree.data.general.*;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import com.jgoodies.forms.layout.FormLayout;
import com.jgoodies.forms.layout.ColumnSpec;
import com.jgoodies.forms.factories.FormFactory;
import com.jgoodies.forms.layout.RowSpec;

public class ChartPresenter extends JPanel {
	private static final long serialVersionUID = 6423561811886542809L;
	
	JPanel chartPanel = new JPanel();
	JPanel controlPanel = new JPanel();
	JComboBox<JFreeChart> chartComboBox = new JComboBox<JFreeChart>();
	Map<Integer, String> chartNamingDictionary = new HashMap<Integer, String>();
	Map<Integer, JFreeChart> chartObjectDictionary = new HashMap<Integer, JFreeChart>();
	
	/**
	 * Create the panel.
	 */
	public ChartPresenter() {
		add(chartPanel);
		chartPanel.setLayout(new BorderLayout(0, 0));
		chartPanel.add(chartComboBox, BorderLayout.NORTH);
		ChartPanel chartContainer = new ChartPanel(null);
		chartPanel.add(chartContainer, BorderLayout.CENTER);	
		
		add(controlPanel);
		JPanel controlPanel_Buttons = new JPanel();
		controlPanel.add(controlPanel_Buttons);
		
		JButton btnPng = new JButton("PNG");
		btnPng.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
			}
		});
		controlPanel_Buttons.setLayout(new FormLayout(new ColumnSpec[] {
				FormFactory.RELATED_GAP_COLSPEC,
				FormFactory.DEFAULT_COLSPEC,
				FormFactory.LABEL_COMPONENT_GAP_COLSPEC,
				ColumnSpec.decode("75px"),
				FormFactory.LABEL_COMPONENT_GAP_COLSPEC,
				ColumnSpec.decode("75px"),},
			new RowSpec[] {
				FormFactory.LINE_GAP_ROWSPEC,
				RowSpec.decode("25px"),}));
		
		Label label = new Label("Save as:");
		controlPanel_Buttons.add(label, "2, 2");
		controlPanel_Buttons.add(btnPng, "4, 2, left, top");
		
		JButton btnJPG = new JButton("JPG");
		btnJPG.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent arg0) {
			}
		});
		controlPanel_Buttons.add(btnJPG, "6, 2, left, top");
	}
	
	public void addChart(JFreeChart chart){
		int new_key = chartNamingDictionary.size() + 1;
		chartNamingDictionary.put(new_key, chart.getTitle().getText());
		chartObjectDictionary.put(new_key, chart);
		chartComboBox.addItem(chart);
		chartComboBox.addItem(chartPanel);
		charts.add(chart);
		reload();
	}
	
	public void reload(){
		chartComboBox = new JComboBox<JFreeChart>();
		for(JFreeChart chart : charts ){
			ChartPanel chartPanel = new ChartPanel(chart);
			chartPanel.setName(chart.getTitle().toString());
			chartComboBox.addItem(chartPanel);
			System.out.println(chart.getTitle().getText());
		}
		
		System.out.println("ChartPresenter reloaded.");
	}
	
	public void empty(){
		charts = new ArrayList<JFreeChart>();
		chartComboBox = new JComboBox<JFreeChart>();
		System.out.println("ChartPresenter emptied.");
		reload();
	}
}
